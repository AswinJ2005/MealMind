<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MealMind Backend Test Tool</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; padding: 20px; line-height: 1.6; background-color: #121212; color: #e0e0e0; }
        .container { max-width: 600px; margin: auto; background-color: #1e1e1e; padding: 25px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.3); }
        h1, h2 { border-bottom: 1px solid #444; padding-bottom: 10px; }
        .token-box { background-color: #2a2a2a; border: 1px solid #444; padding: 10px; margin-top: 10px; border-radius: 4px; word-wrap: break-word; font-family: monospace; min-height: 50px; }
        input { width: calc(100% - 20px); background-color: #2a2a2a; color: #e0e0e0; border: 1px solid #444; border-radius: 4px; }
        button { width: 100%; background-color: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; transition: background-color 0.2s; }
        button:hover { background-color: #0056b3; }
        code { background-color: #333; color: #f0f0f0; padding: 2px 5px; border-radius: 3px; }
        hr { border: none; border-top: 1px solid #444; margin: 25px 0; }
        input, button { padding: 10px; font-size: 1rem; margin: 8px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>MealMind Backend Test Tool</h1>
        
        <h2>Login</h2>
        <input type="email" id="email" placeholder="Email (e.g., finaltest1@example.com)">
        <input type="password" id="password" placeholder="Password">
        <button onclick="loginUser()">Login & Get Token</button>
        
        <hr>
        
        <h2>Your Firebase ID Token</h2>
        <p>Use this token in Postman. Add a Header: <code>Authorization</code> with the value <code>Bearer [TOKEN]</code></p>
        <div id="token-box" class="token-box">
            Logged out
        </div>
        <br>
        <button onclick="logoutUser()">Logout</button>
    </div>

    <!-- The entire logic is now inside a single, modern script tag -->
    <script type="module">
        // --- 1. IMPORT FIREBASE MODULES ---
        // Import the functions you need from the official Firebase CDN
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";


        // --- 2. PASTE YOUR FIREBASE CONFIG OBJECT HERE ---
        // (Copy this directly from the Firebase console's "Add Firebase SDK" script tag section)
        const firebaseConfig = {
            apiKey: "AIzaSyDZG--9-PaVriSP4L1j0WUI4tfd-X0c6u4",
            authDomain: "mealmind-app.firebaseapp.com",
            projectId: "mealmind-app",
            storageBucket: "mealmind-app.firebasestorage.app",
            messagingSenderId: "112917604991",
            appId: "1:112917604991:web:70afd5e9bc699d4e6bed4a"
        };

        // --- 3. INITIALIZE FIREBASE ---
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);


        // --- 4. ATTACH FUNCTIONS TO THE GLOBAL WINDOW OBJECT ---
        // (This makes them accessible by the "onclick" attributes in the HTML above)
        
        window.loginUser = function() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const tokenBox = document.getElementById('token-box');
            
            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    // Get the ID token
                    user.getIdToken().then((token) => {
                        console.log("Token acquired:", token);
                        tokenBox.innerText = token; // Display the token in the grey box
                    });
                })
                .catch((error) => {
                    const errorMessage = error.message;
                    console.error("Login Failed:", errorMessage);
                    tokenBox.innerText = "Error: " + errorMessage; // Display login errors
                });
        }
        
        window.logoutUser = function() {
            signOut(auth).then(() => {
                document.getElementById('token-box').innerText = "Logged out successfully.";
            }).catch((error) => {
                console.error("Logout Failed:", error);
            });
        }
    </script>
</body>
</html>